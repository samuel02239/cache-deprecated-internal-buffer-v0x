<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contabilidad y Finanzas - Grupo de Evangelismo 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA76qCjjW5pZxhMYU6Siekdp_FZMxGdtA8",
            authDomain: "base-evan-contabilidad.firebaseapp.com",
            databaseURL: "https://base-evan-contabilidad-default-rtdb.firebaseio.com",
            projectId: "base-evan-contabilidad",
            storageBucket: "base-evan-contabilidad.firebasestorage.app",
            messagingSenderId: "1073410191118",
            appId: "1:1073410191118:web:9732710acef78b7028f15f",
            measurementId: "G-FT29Y4JGB9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Hacer disponibles las funciones de Firebase globalmente
        window.firebaseDatabase = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebasePush = push;
        window.firebaseOnValue = onValue;
        window.firebaseRemove = remove;
        
        console.log("Firebase inicializado correctamente");
    </script>
    
    <style>
        :root {
            --evangelio-red: #B22222;
            --evangelio-red-dark: #8B0000;
            --evangelio-gold: #FFD700;
            --evangelio-gold-dark: #B8860B;
            --evangelio-blue: #1E90FF;
            --evangelio-green: #228B22;
            --evangelio-purple: #8A2BE2;
            --evangelio-orange: #FF8C00;
            --evangelio-white: #FFFFFF;
            --evangelio-black: #111111;
            --evangelio-gray: #666666;
            --evangelio-light-gray: #F5F5F5;
            --evangelio-bg: #1a0f0f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--evangelio-bg);
            color: var(--evangelio-white);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(178, 34, 34, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 20%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header - Estilo evangel√≠stico */
        .header {
            background: linear-gradient(135deg, var(--evangelio-red-dark), var(--evangelio-red));
            color: var(--evangelio-white);
            padding: 20px 0;
            box-shadow: 0 5px 20px rgba(178, 34, 34, 0.3);
            margin-bottom: 30px;
            border-radius: 0 0 15px 15px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffd700' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 215, 0, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--evangelio-gold);
            border: 2px solid var(--evangelio-gold);
        }

        .header-title h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--evangelio-white);
        }

        .header-title p {
            font-size: 0.9rem;
            opacity: 0.9;
            color: var(--evangelio-gold);
        }

        /* Dashboard - Tarjetas de estad√≠sticas */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255, 215, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(178, 34, 34, 0.2);
            border-color: rgba(255, 215, 0, 0.4);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--evangelio-red), var(--evangelio-gold));
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--evangelio-white);
            flex-shrink: 0;
        }

        .stat-icon.income {
            background: linear-gradient(135deg, var(--evangelio-green), #32CD32);
        }

        .stat-icon.expense {
            background: linear-gradient(135deg, var(--evangelio-red), #FF4444);
        }

        .stat-icon.balance {
            background: linear-gradient(135deg, var(--evangelio-blue), #87CEEB);
        }

        .stat-icon.offering {
            background: linear-gradient(135deg, var(--evangelio-gold), #FFA500);
        }

        .stat-info h3 {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .stat-value.positive {
            color: var(--evangelio-green);
        }

        .stat-value.negative {
            color: var(--evangelio-red);
        }

        /* Alertas */
        .alerts {
            margin-bottom: 30px;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-left: 5px solid;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .alert.warning {
            border-left-color: var(--evangelio-orange);
            background-color: rgba(255, 140, 0, 0.1);
        }

        .alert.info {
            border-left-color: var(--evangelio-blue);
            background-color: rgba(30, 144, 255, 0.1);
        }

        .alert.success {
            border-left-color: var(--evangelio-green);
            background-color: rgba(34, 139, 34, 0.1);
        }

        .alert-icon {
            font-size: 24px;
        }

        .alert.warning .alert-icon {
            color: var(--evangelio-orange);
        }

        .alert.info .alert-icon {
            color: var(--evangelio-blue);
        }

        .alert.success .alert-icon {
            color: var(--evangelio-green);
        }

        /* Contenido principal */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--evangelio-red), var(--evangelio-gold));
        }

        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .section-title h2 {
            font-size: 1.4rem;
            color: var(--evangelio-gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--evangelio-red), var(--evangelio-red-dark));
            color: var(--evangelio-white);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(178, 34, 34, 0.4);
            background: linear-gradient(135deg, var(--evangelio-red-dark), var(--evangelio-red));
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--evangelio-gold), var(--evangelio-gold-dark));
            color: var(--evangelio-black);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--evangelio-gold-dark), var(--evangelio-gold));
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        /* Formularios */
        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--evangelio-gold);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 5px;
            font-size: 1rem;
            background-color: rgba(0, 0, 0, 0.5);
            color: var(--evangelio-white);
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--evangelio-red);
            box-shadow: 0 0 0 2px rgba(178, 34, 34, 0.2);
        }

        /* Tablas */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: rgba(0, 0, 0, 0.3);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        th {
            background-color: rgba(178, 34, 34, 0.2);
            font-weight: 600;
            color: var(--evangelio-gold);
        }

        tr:hover {
            background-color: rgba(255, 215, 0, 0.05);
        }

        .amount-income {
            color: var(--evangelio-green);
            font-weight: 600;
        }

        .amount-expense {
            color: var(--evangelio-red);
            font-weight: 600;
        }

        .actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            color: var(--evangelio-gray);
            transition: color 0.3s;
        }

        .action-btn:hover {
            color: var(--evangelio-gold);
        }

        /* Gr√°ficos */
        .chart-container {
            height: 300px;
            margin-top: 20px;
            position: relative;
        }

        /* Filtros */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            color: var(--evangelio-gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--evangelio-gold);
            border-bottom-color: var(--evangelio-red);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Reportes */
        .reports-section {
            margin-top: 30px;
        }

        .report-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .report-card {
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(178, 34, 34, 0.2);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .report-card i {
            font-size: 36px;
            color: var(--evangelio-gold);
            margin-bottom: 15px;
        }

        .report-card h3 {
            color: var(--evangelio-white);
            margin-bottom: 10px;
        }

        .report-card p {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Firebase Status */
        .firebase-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .firebase-status.connected {
            background-color: var(--evangelio-green);
            color: white;
        }

        .firebase-status.disconnected {
            background-color: var(--evangelio-red);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .firebase-status {
                bottom: 10px;
                right: 10px;
                left: 10px;
                text-align: center;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Firebase Status Indicator -->
    <div id="firebaseStatus" class="firebase-status disconnected">
        <i class="fas fa-cloud"></i>
        <span>Conectando a Firebase...</span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-cross"></i>
                </div>
                <div class="header-title">
                    <h1>Contabilidad Evangel√≠stica</h1>
                    <p>Grupo de Evangelismo 2026 - Gesti√≥n de Recursos</p>
                </div>
            </div>
            
            <div class="user-section">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" id="backupBtn">
                        <i class="fas fa-cloud-upload-alt"></i> Sincronizar
                    </button>
                    <button class="btn-secondary" id="newMonthBtn">
                        <i class="fas fa-calendar-plus"></i> Nuevo Mes
                    </button>
                    <button class="btn-secondary" id="exportBtn">
                        <i class="fas fa-file-export"></i> Exportar
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Dashboard de estad√≠sticas -->
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-icon income">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <div class="stat-info">
                    <h3>Ingresos Totales</h3>
                    <div class="stat-value positive" id="totalIncome">$0.00</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon expense">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-info">
                    <h3>Egresos Totales</h3>
                    <div class="stat-value negative" id="totalExpense">$0.00</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon balance">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <div class="stat-info">
                    <h3>Saldo Actual</h3>
                    <div class="stat-value positive" id="currentBalance">$0.00</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon offering">
                    <i class="fas fa-cross"></i>
                </div>
                <div class="stat-info">
                    <h3>Ofrendas Evangel√≠sticas</h3>
                    <div class="stat-value positive" id="totalOffering">$0.00</div>
                </div>
            </div>
        </div>
        
        <!-- Alertas -->
        <div class="alerts" id="alertsContainer">
            <div class="alert info">
                <div class="alert-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div>Bienvenido al sistema de contabilidad evangel√≠stica. Los datos se sincronizan autom√°ticamente con la nube.</div>
            </div>
        </div>
        
        <!-- Contenido principal -->
        <div class="main-content">
            <!-- Columna izquierda -->
            <div class="left-column">
                <!-- Registro de transacciones -->
                <div class="section">
                    <div class="section-title">
                        <h2><i class="fas fa-plus-circle"></i> Registrar Transacci√≥n</h2>
                    </div>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="income">Ingreso Evangel√≠stico</div>
                        <div class="tab" data-tab="expense">Gasto Ministerial</div>
                    </div>
                    
                    <!-- Formulario de ingreso -->
                    <div id="incomeForm" class="tab-content active">
                        <form id="addIncomeForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="incomeDate">Fecha</label>
                                    <input type="date" id="incomeDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="incomeType">Tipo de Ingreso</label>
                                    <select id="incomeType" required>
                                        <option value="">Seleccionar</option>
                                        <option value="ofrenda">Ofrenda Evangel√≠stica</option>
                                        <option value="donacion">Donaci√≥n Especial</option>
                                        <option value="evento">Colecta de Evento</option>
                                        <option value="venta">Venta de Material</option>
                                        <option value="aporte">Aporte de Miembros</option>
                                        <option value="otro">Otro Ingreso</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="incomeAmount">Monto ($)</label>
                                    <input type="number" id="incomeAmount" min="0" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="incomeResponsible">Responsable</label>
                                    <input type="text" id="incomeResponsible" required placeholder="Nombre del encargado">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="incomeDescription">Descripci√≥n (Actividad/Prop√≥sito)</label>
                                <textarea id="incomeDescription" rows="3" required placeholder="Ej: Ofrenda recogida en campa√±a evangel√≠stica del s√°bado..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn">
                                <i class="fas fa-save"></i> Registrar Ingreso
                            </button>
                        </form>
                    </div>
                    
                    <!-- Formulario de egreso -->
                    <div id="expenseForm" class="tab-content">
                        <form id="addExpenseForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseDate">Fecha</label>
                                    <input type="date" id="expenseDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="expenseCategory">Categor√≠a Ministerial</label>
                                    <select id="expenseCategory" required>
                                        <option value="">Seleccionar</option>
                                        <option value="materiales">Materiales Evangel√≠sticos</option>
                                        <option value="transporte">Transporte para Evangelismo</option>
                                        <option value="alimentacion">Alimentaci√≥n en Campa√±as</option>
                                        <option value="equipos">Equipos (Sonido/Megafon√≠a)</option>
                                        <option value="publicidad">Publicidad Evangel√≠stica</option>
                                        <option value="ayuda">Ayuda Social (Ministerio)</option>
                                        <option value="capacitacion">Capacitaci√≥n de Evangelistas</option>
                                        <option value="otros">Otros Gastos Ministeriales</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expenseAmount">Monto ($)</label>
                                    <input type="number" id="expenseAmount" min="0" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="expenseAuthorized">Autorizado por</label>
                                    <input type="text" id="expenseAuthorized" required placeholder="Nombre del l√≠der">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="expenseReason">Motivo del Gasto Ministerial</label>
                                <textarea id="expenseReason" rows="3" required placeholder="Ej: Compra de Biblias para repartir en campa√±a..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn">
                                <i class="fas fa-save"></i> Registrar Gasto Ministerial
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Gr√°fico de distribuci√≥n de gastos ministeriales -->
                <div class="section">
                    <div class="section-title">
                        <h2><i class="fas fa-chart-pie"></i> Gastos Ministeriales</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="expenseChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Columna derecha -->
            <div class="right-column">
                <!-- Tabla de transacciones recientes -->
                <div class="section">
                    <div class="section-title">
                        <h2><i class="fas fa-history"></i> Transacciones Recientes</h2>
                        <div class="filters">
                            <select id="filterType">
                                <option value="all">Todas las transacciones</option>
                                <option value="income">Solo ingresos</option>
                                <option value="expense">Solo gastos</option>
                            </select>
                            <select id="filterMonth">
                                <option value="all">Todos los meses</option>
                                <!-- Los meses se cargar√°n din√°micamente -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="transactionsTable">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Descripci√≥n</th>
                                    <th>Monto</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsBody">
                                <!-- Las transacciones se cargar√°n desde Firebase -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Gr√°fico de balance mensual -->
                <div class="section">
                    <div class="section-title">
                        <h2><i class="fas fa-chart-line"></i> Balance Ministerial</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="balanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Secci√≥n de reportes evangel√≠sticos -->
        <div class="section reports-section">
            <div class="section-title">
                <h2><i class="fas fa-file-alt"></i> Reportes Ministeriales</h2>
            </div>
            
            <div class="report-options">
                <div class="report-card" id="monthlyReport">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Reporte Mensual</h3>
                    <p>Resumen de finanzas del mes</p>
                </div>
                
                <div class="report-card" id="quarterlyReport">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Reporte Trimestral</h3>
                    <p>Balance cada 3 meses</p>
                </div>
                
                <div class="report-card" id="annualReport">
                    <i class="fas fa-chart-line"></i>
                    <h3>Reporte Anual</h3>
                    <p>Resumen completo del a√±o</p>
                </div>
                
                <div class="report-card" id="offeringReport">
                    <i class="fas fa-cross"></i>
                    <h3>Reporte de Ofrendas</h3>
                    <p>Detalle de ofrendas evangel√≠sticas</p>
                </div>
            </div>
            
            <div id="reportContent" style="display: none;">
                <div class="section-title">
                    <h2 id="reportTitle"></h2>
                    <div>
                        <button class="btn-secondary" id="printReport">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                        <button class="btn-secondary" id="exportExcel">
                            <i class="fas fa-file-excel"></i> Exportar
                        </button>
                    </div>
                </div>
                
                <div id="reportDetails">
                    <!-- El contenido del reporte se cargar√° aqu√≠ -->
                </div>
            </div>
        </div>
        
        <!-- Informaci√≥n de uso para evangelismo -->
        <div class="section" style="margin-top: 30px;">
            <div class="section-title">
                <h2><i class="fas fa-info-circle"></i> Gu√≠a para la Administraci√≥n Ministerial</h2>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <h3 style="color: var(--evangelio-gold); margin-bottom: 10px;">üìù Primeros Pasos</h3>
                    <ul style="padding-left: 20px; line-height: 1.6; color: rgba(255,255,255,0.8);">
                        <li><strong>1.</strong> Registra todas las ofrendas recogidas en actividades evangel√≠sticas</li>
                        <li><strong>2.</strong> Documenta cada gasto ministerial con su prop√≥sito evangel√≠stico</li>
                        <li><strong>3.</strong> Usa descripciones claras para cada transacci√≥n</li>
                        <li><strong>4.</strong> Revisa el saldo disponible para planificar pr√≥ximas campa√±as</li>
                        <li><strong>5.</strong> Genera reportes para presentar a los miembros del grupo</li>
                    </ul>
                </div>
                
                <div>
                    <h3 style="color: var(--evangelio-gold); margin-bottom: 10px;">üí° Buenas Pr√°cticas</h3>
                    <ul style="padding-left: 20px; line-height: 1.6; color: rgba(255,255,255,0.8);">
                        <li>‚Ä¢ Registra las transacciones inmediatamente despu√©s de cada actividad</li>
                        <li>‚Ä¢ Clasifica correctamente cada ingreso y gasto ministerial</li>
                        <li>‚Ä¢ Mant√©n registros detallados para transparencia</li>
                        <li>‚Ä¢ Presenta reportes mensuales al grupo de evangelismo</li>
                        <li>‚Ä¢ Sincroniza regularmente con Firebase para respaldo</li>
                    </ul>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background-color: rgba(178, 34, 34, 0.1); border-radius: 10px; border-left: 4px solid var(--evangelio-gold);">
                <h3 style="color: var(--evangelio-gold); margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> Importancia de la Transparencia</h3>
                <p style="color: rgba(255,255,255,0.8);">"La buena administraci√≥n de los recursos es testimonio de nuestra mayordom√≠a. Cada peso debe ser usado sabiamente para la extensi√≥n del Reino de Dios. La transparencia financiera fortalece la confianza y permite que m√°s personas se unan a la obra evangel√≠stica."</p>
            </div>
        </div>
        
        <!-- Nota sobre sincronizaci√≥n -->
        <div style="text-align: center; margin-top: 30px; padding: 15px; background-color: rgba(255, 215, 0, 0.1); border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.3);">
            <p><i class="fas fa-cloud" style="color: var(--evangelio-gold);"></i> <strong>Sincronizaci√≥n Autom√°tica:</strong> Todos los datos se guardan autom√°ticamente en Firebase. Puedes acceder desde cualquier dispositivo con internet.</p>
        </div>
    </div>

    <script>
        // Variables globales
        let transactions = [];
        let firebaseConnected = false;
        
        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', async function() {
            // Esperar a que Firebase se inicialice
            setTimeout(async () => {
                await initializeApp();
                setupEventListeners();
                initializeDateInputs();
                updateFirebaseStatus();
            }, 1000);
        });
        
        // Inicializar Firebase y cargar datos
        async function initializeApp() {
            try {
                // Verificar que Firebase est√© disponible
                if (!window.firebaseDatabase) {
                    throw new Error("Firebase no se ha inicializado correctamente");
                }
                
                // Configurar listener para cambios en tiempo real
                const transactionsRef = window.firebaseRef(window.firebaseDatabase, 'evangelismo2026/transacciones');
                
                window.firebaseOnValue(transactionsRef, (snapshot) => {
                    const data = snapshot.val();
                    transactions = [];
                    
                    if (data) {
                        // Convertir objeto a array
                        Object.keys(data).forEach(key => {
                            transactions.push({
                                id: key,
                                ...data[key]
                            });
                        });
                    }
                    
                    // Actualizar interfaz
                    updateDashboard();
                    updateTransactionsTable();
                    updateCharts();
                    updateAlerts();
                    loadMonthFilters();
                    
                    // Actualizar estado de Firebase
                    updateFirebaseStatus(true);
                    
                    console.log("Datos cargados desde Firebase:", transactions.length, "transacciones");
                }, (error) => {
                    console.error("Error al cargar datos de Firebase:", error);
                    updateFirebaseStatus(false);
                    
                    // Cargar datos de localStorage como respaldo
                    loadFromLocalStorage();
                });
                
            } catch (error) {
                console.error("Error inicializando Firebase:", error);
                updateFirebaseStatus(false);
                
                // Cargar datos de localStorage como respaldo
                loadFromLocalStorage();
            }
        }
        
        // Cargar datos del localStorage como respaldo
        function loadFromLocalStorage() {
            const savedTransactions = localStorage.getItem('evangelismoTransactions');
            if (savedTransactions) {
                transactions = JSON.parse(savedTransactions);
                updateDashboard();
                updateTransactionsTable();
                updateCharts();
                updateAlerts();
                loadMonthFilters();
                
                showAlert("Usando datos locales (sin conexi√≥n a Firebase)", "warning");
            } else {
                showAlert("Conectando a Firebase...", "info");
            }
        }
        
        // Guardar transacci√≥n en Firebase
        async function saveTransactionToFirebase(transaction) {
            try {
                const transactionsRef = window.firebaseRef(window.firebaseDatabase, 'evangelismo2026/transacciones');
                const newTransactionRef = window.firebasePush(transactionsRef);
                
                // Eliminar el id temporal y agregar timestamp
                const { id, ...transactionData } = transaction;
                transactionData.createdAt = new Date().toISOString();
                
                await window.firebaseSet(newTransactionRef, transactionData);
                return newTransactionRef.key;
            } catch (error) {
                console.error("Error guardando en Firebase:", error);
                throw error;
            }
        }
        
        // Actualizar transacci√≥n en Firebase
        async function updateTransactionInFirebase(id, updatedData) {
            try {
                const transactionRef = window.firebaseRef(window.firebaseDatabase, `evangelismo2026/transacciones/${id}`);
                await window.firebaseSet(transactionRef, updatedData);
                return true;
            } catch (error) {
                console.error("Error actualizando en Firebase:", error);
                throw error;
            }
        }
        
        // Eliminar transacci√≥n de Firebase
        async function deleteTransactionFromFirebase(id) {
            try {
                const transactionRef = window.firebaseRef(window.firebaseDatabase, `evangelismo2026/transacciones/${id}`);
                await window.firebaseRemove(transactionRef);
                return true;
            } catch (error) {
                console.error("Error eliminando de Firebase:", error);
                throw error;
            }
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // Tabs para formularios
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Form`).classList.add('active');
                });
            });
            
            // Formulario de ingreso
            document.getElementById('addIncomeForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const date = document.getElementById('incomeDate').value;
                const type = document.getElementById('incomeType').value;
                const amount = parseFloat(document.getElementById('incomeAmount').value);
                const description = document.getElementById('incomeDescription').value;
                const responsible = document.getElementById('incomeResponsible').value;
                
                if (!date || !type || !amount || !description || !responsible) {
                    showAlert('Por favor, completa todos los campos', 'warning');
                    return;
                }
                
                const transactionDate = new Date(date);
                const newTransaction = {
                    id: Date.now().toString(),
                    type: 'income',
                    date: date,
                    amount: amount,
                    description: description,
                    category: type,
                    responsible: responsible,
                    month: transactionDate.getMonth() + 1,
                    year: transactionDate.getFullYear(),
                    createdAt: new Date().toISOString()
                };
                
                try {
                    if (firebaseConnected) {
                        await saveTransactionToFirebase(newTransaction);
                    } else {
                        // Guardar localmente si no hay conexi√≥n
                        transactions.push(newTransaction);
                        saveToLocalStorage();
                        updateDashboard();
                        updateTransactionsTable();
                        updateCharts();
                        updateAlerts();
                        loadMonthFilters();
                    }
                    
                    this.reset();
                    document.getElementById('incomeDate').value = getCurrentDate();
                    
                    showSuccessMessage('Ingreso registrado exitosamente');
                } catch (error) {
                    showAlert('Error al guardar el ingreso: ' + error.message, 'warning');
                }
            });
            
            // Formulario de egreso
            document.getElementById('addExpenseForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const date = document.getElementById('expenseDate').value;
                const category = document.getElementById('expenseCategory').value;
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                const reason = document.getElementById('expenseReason').value;
                const authorized = document.getElementById('expenseAuthorized').value;
                
                if (!date || !category || !amount || !reason || !authorized) {
                    showAlert('Por favor, completa todos los campos', 'warning');
                    return;
                }
                
                const transactionDate = new Date(date);
                const newTransaction = {
                    id: Date.now().toString(),
                    type: 'expense',
                    date: date,
                    amount: amount,
                    description: reason,
                    category: category,
                    authorized: authorized,
                    month: transactionDate.getMonth() + 1,
                    year: transactionDate.getFullYear(),
                    createdAt: new Date().toISOString()
                };
                
                try {
                    if (firebaseConnected) {
                        await saveTransactionToFirebase(newTransaction);
                    } else {
                        transactions.push(newTransaction);
                        saveToLocalStorage();
                        updateDashboard();
                        updateTransactionsTable();
                        updateCharts();
                        updateAlerts();
                        loadMonthFilters();
                    }
                    
                    this.reset();
                    document.getElementById('expenseDate').value = getCurrentDate();
                    
                    showSuccessMessage('Gasto ministerial registrado exitosamente');
                } catch (error) {
                    showAlert('Error al guardar el gasto: ' + error.message, 'warning');
                }
            });
            
            // Filtros de transacciones
            document.getElementById('filterType').addEventListener('change', updateTransactionsTable);
            document.getElementById('filterMonth').addEventListener('change', updateTransactionsTable);
            
            // Botones de reportes
            document.getElementById('monthlyReport').addEventListener('click', () => generateReport('monthly'));
            document.getElementById('quarterlyReport').addEventListener('click', () => generateReport('quarterly'));
            document.getElementById('annualReport').addEventListener('click', () => generateReport('annual'));
            document.getElementById('offeringReport').addEventListener('click', () => generateReport('offering'));
            
            // Botones de exportaci√≥n
            document.getElementById('printReport').addEventListener('click', printReport);
            document.getElementById('exportExcel').addEventListener('click', exportToExcel);
            
            // Bot√≥n de sincronizaci√≥n
            document.getElementById('backupBtn').addEventListener('click', syncWithFirebase);
            
            // Bot√≥n de nuevo mes
            document.getElementById('newMonthBtn').addEventListener('click', startNewMonth);
            
            // Bot√≥n de exportaci√≥n
            document.getElementById('exportBtn').addEventListener('click', exportAllData);
        }
        
        // Inicializar campos de fecha
        function initializeDateInputs() {
            const currentDate = getCurrentDate();
            document.getElementById('incomeDate').value = currentDate;
            document.getElementById('expenseDate').value = currentDate;
        }
        
        // Obtener fecha actual
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Actualizar dashboard
        function updateDashboard() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const currentBalance = totalIncome - totalExpense;
            
            const totalOffering = transactions
                .filter(t => t.type === 'income' && t.category === 'ofrenda')
                .reduce((sum, t) => sum + t.amount, 0);
            
            document.getElementById('totalIncome').textContent = `$${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpense').textContent = `$${totalExpense.toFixed(2)}`;
            document.getElementById('currentBalance').textContent = `$${currentBalance.toFixed(2)}`;
            document.getElementById('totalOffering').textContent = `$${totalOffering.toFixed(2)}`;
            
            const balanceElement = document.getElementById('currentBalance');
            balanceElement.className = currentBalance >= 0 ? 'stat-value positive' : 'stat-value negative';
        }
        
        // Actualizar tabla de transacciones
        function updateTransactionsTable() {
            const filterType = document.getElementById('filterType').value;
            const filterMonth = document.getElementById('filterMonth').value;
            
            let filteredTransactions = transactions;
            
            if (filterType !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.type === filterType);
            }
            
            if (filterMonth !== 'all') {
                const [month, year] = filterMonth.split('-');
                filteredTransactions = filteredTransactions.filter(t => 
                    t.month == month && t.year == year
                );
            }
            
            filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const tbody = document.getElementById('transactionsBody');
            tbody.innerHTML = '';
            
            filteredTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                
                const dateObj = new Date(transaction.date);
                const formattedDate = dateObj.toLocaleDateString('es-ES');
                
                const typeText = transaction.type === 'income' ? 'Ingreso' : 'Gasto';
                const categoryText = getCategoryText(transaction.category);
                
                const amountClass = transaction.type === 'income' ? 'amount-income' : 'amount-expense';
                const amountPrefix = transaction.type === 'income' ? '+' : '-';
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${typeText} - ${categoryText}</td>
                    <td>${transaction.description}</td>
                    <td class="${amountClass}">${amountPrefix}$${transaction.amount.toFixed(2)}</td>
                    <td class="actions">
                        <button class="action-btn delete-btn" data-id="${transaction.id}" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Agregar event listeners a los botones de eliminar
            addDeleteButtonListeners();
        }
        
        // Obtener texto descriptivo para categor√≠as
        function getCategoryText(category) {
            const categories = {
                'ofrenda': 'Ofrenda Evangel√≠stica',
                'donacion': 'Donaci√≥n Especial',
                'evento': 'Colecta de Evento',
                'venta': 'Venta de Material',
                'aporte': 'Aporte de Miembros',
                'otro': 'Otro Ingreso',
                'materiales': 'Materiales Evangel√≠sticos',
                'transporte': 'Transporte para Evangelismo',
                'alimentacion': 'Alimentaci√≥n en Campa√±as',
                'equipos': 'Equipos (Sonido/Megafon√≠a)',
                'publicidad': 'Publicidad Evangel√≠stica',
                'ayuda': 'Ayuda Social (Ministerio)',
                'capacitacion': 'Capacitaci√≥n de Evangelistas',
                'otros': 'Otros Gastos Ministeriales'
            };
            
            return categories[category] || category;
        }
        
        // Agregar event listeners a los botones de eliminar
        function addDeleteButtonListeners() {
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const id = this.getAttribute('data-id');
                    
                    if (!confirm('¬øEst√°s seguro de que deseas eliminar esta transacci√≥n?')) return;
                    
                    try {
                        if (firebaseConnected) {
                            await deleteTransactionFromFirebase(id);
                        } else {
                            const index = transactions.findIndex(t => t.id === id);
                            if (index !== -1) {
                                transactions.splice(index, 1);
                                saveToLocalStorage();
                                updateDashboard();
                                updateTransactionsTable();
                                updateCharts();
                                updateAlerts();
                            }
                        }
                        
                        showSuccessMessage('Transacci√≥n eliminada exitosamente');
                    } catch (error) {
                        showAlert('Error al eliminar la transacci√≥n: ' + error.message, 'warning');
                    }
                });
            });
        }
        
        // Actualizar gr√°ficos
        function updateCharts() {
            updateExpenseChart();
            updateBalanceChart();
        }
        
        // Actualizar gr√°fico de gastos
        function updateExpenseChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            const expensesByCategory = {};
            transactions
                .filter(t => t.type === 'expense')
                .forEach(transaction => {
                    const category = getCategoryText(transaction.category);
                    if (!expensesByCategory[category]) {
                        expensesByCategory[category] = 0;
                    }
                    expensesByCategory[category] += transaction.amount;
                });
            
            const categories = Object.keys(expensesByCategory);
            const amounts = Object.values(expensesByCategory);
            
            if (categories.length === 0) {
                const canvas = document.getElementById('expenseChart');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#FFD700';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No hay gastos ministeriales registrados', canvas.width/2, canvas.height/2);
                return;
            }
            
            const backgroundColors = [
                '#B22222', '#FFD700', '#1E90FF', '#228B22', 
                '#8A2BE2', '#FF8C00', '#32CD32', '#87CEEB',
                '#8B0000', '#B8860B'
            ];
            
            if (window.expenseChartInstance) {
                window.expenseChartInstance.destroy();
            }
            
            window.expenseChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        data: amounts,
                        backgroundColor: backgroundColors.slice(0, categories.length),
                        borderWidth: 1,
                        borderColor: '#111'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#FFF'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Distribuci√≥n de Gastos Ministeriales',
                            color: '#FFD700'
                        }
                    }
                }
            });
        }
        
        // Actualizar gr√°fico de balance
        function updateBalanceChart() {
            const ctx = document.getElementById('balanceChart').getContext('2d');
            
            const currentDate = new Date();
            const months = [];
            const incomeData = [];
            const expenseData = [];
            const balanceData = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const month = date.getMonth() + 1;
                const year = date.getFullYear();
                
                const monthName = date.toLocaleDateString('es-ES', { month: 'short' });
                months.push(`${monthName} ${year}`);
                
                const monthIncome = transactions
                    .filter(t => t.type === 'income' && t.month === month && t.year === year)
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const monthExpense = transactions
                    .filter(t => t.type === 'expense' && t.month === month && t.year === year)
                    .reduce((sum, t) => sum + t.amount, 0);
                
                incomeData.push(monthIncome);
                expenseData.push(monthExpense);
                balanceData.push(monthIncome - monthExpense);
            }
            
            if (incomeData.every(v => v === 0) && expenseData.every(v => v === 0)) {
                const canvas = document.getElementById('balanceChart');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#FFD700';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No hay datos para mostrar', canvas.width/2, canvas.height/2);
                return;
            }
            
            if (window.balanceChartInstance) {
                window.balanceChartInstance.destroy();
            }
            
            window.balanceChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Ingresos Evangel√≠sticos',
                            data: incomeData,
                            borderColor: '#228B22',
                            backgroundColor: 'rgba(34, 139, 34, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Gastos Ministeriales',
                            data: expenseData,
                            borderColor: '#B22222',
                            backgroundColor: 'rgba(178, 34, 34, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'Balance',
                            data: balanceData,
                            borderColor: '#FFD700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            fill: true,
                            tension: 0.3,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evoluci√≥n Financiera Ministerial',
                            color: '#FFD700'
                        },
                        legend: {
                            labels: {
                                color: '#FFF'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#FFF'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#FFF',
                                callback: function(value) {
                                    return '$' + value;
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }
        
        // Actualizar alertas
        function updateAlerts() {
            const container = document.getElementById('alertsContainer');
            
            // Mantener la alerta de Firebase si existe
            const existingAlerts = container.querySelectorAll('.alert');
            const hasFirebaseAlert = Array.from(existingAlerts).some(alert => 
                alert.textContent.includes('Firebase')
            );
            
            if (!hasFirebaseAlert) {
                container.innerHTML = '';
                
                // Calcular saldo
                const totalIncome = transactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const totalExpense = transactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const currentBalance = totalIncome - totalExpense;
                
                // Alertas seg√∫n condiciones
                const alerts = [];
                
                if (currentBalance < 100 && currentBalance >= 0) {
                    alerts.push({
                        type: 'warning',
                        icon: 'fas fa-exclamation-triangle',
                        message: 'El saldo ministerial es bajo. Considera recaudar m√°s fondos para las pr√≥ximas campa√±as.'
                    });
                } else if (currentBalance < 0) {
                    alerts.push({
                        type: 'warning',
                        icon: 'fas fa-exclamation-triangle',
                        message: '¬°Atenci√≥n! El fondo tiene saldo negativo. Revisa los gastos y planifica nuevas actividades de recaudaci√≥n.'
                    });
                }
                
                // Mostrar alertas
                alerts.forEach(alert => {
                    const alertElement = document.createElement('div');
                    alertElement.className = `alert ${alert.type}`;
                    alertElement.innerHTML = `
                        <div class="alert-icon">
                            <i class="${alert.icon}"></i>
                        </div>
                        <div>${alert.message}</div>
                    `;
                    container.appendChild(alertElement);
                });
                
                // Si no hay alertas, mostrar mensaje positivo
                if (alerts.length === 0 && transactions.length > 0) {
                    container.innerHTML = '<div class="alert success"><div class="alert-icon"><i class="fas fa-check-circle"></i></div><div>Las finanzas ministeriales est√°n en orden. ¬°Bendiciones en la obra evangel√≠stica!</div></div>';
                }
            }
        }
        
        // Cargar filtros de meses
        function loadMonthFilters() {
            const select = document.getElementById('filterMonth');
            const currentSelection = select.value;
            
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            const monthsSet = new Set();
            transactions.forEach(t => {
                if (t.month && t.year) {
                    const date = new Date(t.year, t.month - 1, 1);
                    const monthName = date.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
                    monthsSet.add({
                        value: `${t.month}-${t.year}`,
                        text: monthName,
                        month: t.month,
                        year: t.year
                    });
                }
            });
            
            const monthsArray = Array.from(monthsSet);
            monthsArray.sort((a, b) => {
                if (b.year !== a.year) return b.year - a.year;
                return b.month - a.month;
            });
            
            monthsArray.forEach(month => {
                const option = document.createElement('option');
                option.value = month.value;
                option.textContent = month.text;
                select.appendChild(option);
            });
            
            if (currentSelection && currentSelection !== 'all') {
                select.value = currentSelection;
            }
        }
        
        // Generar reportes
        function generateReport(type) {
            const reportContent = document.getElementById('reportContent');
            const reportTitle = document.getElementById('reportTitle');
            const reportDetails = document.getElementById('reportDetails');
            
            reportContent.style.display = 'block';
            
            let title = '';
            let content = '';
            
            switch(type) {
                case 'monthly':
                    title = 'Reporte Mensual Ministerial';
                    content = generateMonthlyReport();
                    break;
                case 'quarterly':
                    title = 'Reporte Trimestral Evangel√≠stico';
                    content = generateQuarterlyReport();
                    break;
                case 'annual':
                    title = 'Reporte Anual de Ministerios';
                    content = generateAnnualReport();
                    break;
                case 'offering':
                    title = 'Reporte de Ofrendas Evangel√≠sticas';
                    content = generateOfferingReport();
                    break;
            }
            
            reportTitle.textContent = title;
            reportDetails.innerHTML = content;
            
            reportContent.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Generar reporte mensual
        function generateMonthlyReport() {
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth() + 1;
            const currentYear = currentDate.getFullYear();
            
            const monthlyTransactions = transactions.filter(t => 
                t.month === currentMonth && t.year === currentYear
            );
            
            const monthlyIncome = monthlyTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const monthlyExpense = monthlyTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const monthlyBalance = monthlyIncome - monthlyExpense;
            
            const monthlyOfferings = monthlyTransactions
                .filter(t => t.type === 'income' && t.category === 'ofrenda');
                
            const totalOfferings = monthlyOfferings.reduce((sum, t) => sum + t.amount, 0);
            const averageOffering = monthlyOfferings.length > 0 ? totalOfferings / monthlyOfferings.length : 0;
            
            let transactionsTable = '';
            
            if (monthlyTransactions.length > 0) {
                transactionsTable = '<table style="width:100%; color:white;"><thead><tr><th>Fecha</th><th>Tipo</th><th>Descripci√≥n</th><th>Monto</th></tr></thead><tbody>';
                
                monthlyTransactions.forEach(t => {
                    const typeText = t.type === 'income' ? 'Ingreso' : 'Gasto';
                    const categoryText = getCategoryText(t.category);
                    const dateObj = new Date(t.date);
                    const formattedDate = dateObj.toLocaleDateString('es-ES');
                    const amountClass = t.type === 'income' ? 'amount-income' : 'amount-expense';
                    const amountPrefix = t.type === 'income' ? '+' : '-';
                    
                    transactionsTable += `
                        <tr>
                            <td>${formattedDate}</td>
                            <td>${typeText} - ${categoryText}</td>
                            <td>${t.description}</td>
                            <td class="${amountClass}">${amountPrefix}$${t.amount.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                transactionsTable += '</tbody></table>';
            } else {
                transactionsTable = '<p style="text-align:center; padding:20px; color:#FFD700;">No hay transacciones registradas este mes.</p>';
            }
            
            return `
                <div style="margin-bottom: 20px; color: white;">
                    <p><strong>Per√≠odo:</strong> ${currentDate.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' })}</p>
                    <p><strong>Total Ingresos:</strong> $${monthlyIncome.toFixed(2)}</p>
                    <p><strong>Total Gastos Ministeriales:</strong> $${monthlyExpense.toFixed(2)}</p>
                    <p><strong>Balance del Mes:</strong> $${monthlyBalance.toFixed(2)}</p>
                    <p><strong>Total de Ofrendas Evangel√≠sticas:</strong> $${totalOfferings.toFixed(2)}</p>
                    <p><strong>Promedio por Ofrenda:</strong> $${averageOffering.toFixed(2)}</p>
                    <p><strong>Cantidad de Ofrendas:</strong> ${monthlyOfferings.length}</p>
                </div>
                
                <h3 style="margin-top: 20px; margin-bottom: 10px; color: #FFD700;">Transacciones del Mes</h3>
                <div class="table-container">
                    ${transactionsTable}
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background-color: rgba(178, 34, 34, 0.1); border-radius: 5px; color: white;">
                    <h4>An√°lisis Ministerial</h4>
                    <p>${monthlyBalance >= 0 ? 
                        '‚úÖ Las finanzas ministeriales est√°n saludables este mes.' : 
                        '‚ö†Ô∏è El fondo tiene un balance negativo. Considera organizar actividades de recaudaci√≥n.'}</p>
                    <p>${monthlyOfferings.length > 0 ? 
                        '‚úÖ Se registraron ofrendas en actividades evangel√≠sticas.' : 
                        '‚ÑπÔ∏è No se registraron ofrendas este mes. Considera promover m√°s la participaci√≥n.'}</p>
                </div>
            `;
        }
        
        // Generar reporte trimestral
        function generateQuarterlyReport() {
            const currentDate = new Date();
            const currentQuarter = Math.floor((currentDate.getMonth() + 3) / 3);
            const currentYear = currentDate.getFullYear();
            
            const quarterMonths = [];
            for (let i = 1; i <= 3; i++) {
                quarterMonths.push((currentQuarter - 1) * 3 + i);
            }
            
            let content = `
                <div style="margin-bottom: 20px; color: white;">
                    <p><strong>Per√≠odo:</strong> ${getQuarterName(currentQuarter)} Trimestre ${currentYear}</p>
            `;
            
            let quarterIncome = 0;
            let quarterExpense = 0;
            
            quarterMonths.forEach(month => {
                const monthlyTransactions = transactions.filter(t => 
                    t.month === month && t.year === currentYear
                );
                
                const monthlyIncome = monthlyTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const monthlyExpense = monthlyTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                quarterIncome += monthlyIncome;
                quarterExpense += monthlyExpense;
                
                const monthName = new Date(currentYear, month - 1, 1).toLocaleDateString('es-ES', { month: 'long' });
                const monthlyBalance = monthlyIncome - monthlyExpense;
                
                content += `
                    <div style="margin-bottom: 15px; padding: 10px; border-left: 3px solid #FFD700; background-color: rgba(0,0,0,0.3); color: white;">
                        <h4>${monthName}</h4>
                        <p><strong>Ingresos:</strong> $${monthlyIncome.toFixed(2)}</p>
                        <p><strong>Gastos:</strong> $${monthlyExpense.toFixed(2)}</p>
                        <p><strong>Balance:</strong> $${monthlyBalance.toFixed(2)}</p>
                    </div>
                `;
            });
            
            const quarterBalance = quarterIncome - quarterExpense;
            
            content += `
                    <div style="margin-top: 20px; padding: 15px; background-color: rgba(178, 34, 34, 0.1); border-radius: 5px; color: white;">
                        <h4>Resumen Trimestral Evangel√≠stico</h4>
                        <p><strong>Total Ingresos del Trimestre:</strong> $${quarterIncome.toFixed(2)}</p>
                        <p><strong>Total Gastos Ministeriales:</strong> $${quarterExpense.toFixed(2)}</p>
                        <p><strong>Balance del Trimestre:</strong> $${quarterBalance.toFixed(2)}</p>
                    </div>
                </div>
            `;
            
            return content;
        }
        
        // Generar reporte anual
        function generateAnnualReport() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            
            const annualTransactions = transactions.filter(t => t.year === currentYear);
            
            const annualIncome = annualTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const annualExpense = annualTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const annualBalance = annualIncome - annualExpense;
            
            return `
                <div style="margin-bottom: 20px; color: white;">
                    <p><strong>Per√≠odo:</strong> A√±o ${currentYear}</p>
                    <p><strong>Total Ingresos Anuales:</strong> $${annualIncome.toFixed(2)}</p>
                    <p><strong>Total Gastos Ministeriales:</strong> $${annualExpense.toFixed(2)}</p>
                    <p><strong>Balance Anual:</strong> $${annualBalance.toFixed(2)}</p>
                    <p><strong>Cantidad de Transacciones:</strong> ${annualTransactions.length}</p>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background-color: rgba(178, 34, 34, 0.1); border-radius: 5px; color: white;">
                    <h4>Perspectiva Anual</h4>
                    <p>${annualBalance >= 0 ? 
                        '‚úÖ El ministerio finaliz√≥ el a√±o con finanzas saludables.' : 
                        '‚ö†Ô∏è El fondo finaliz√≥ el a√±o con balance negativo. Revisa la estrategia financiera para el pr√≥ximo a√±o.'}</p>
                    <p><strong>Recomendaci√≥n:</strong> Basado en los datos de este a√±o, planifica el presupuesto del pr√≥ximo a√±o para maximizar el impacto evangel√≠stico.</p>
                </div>
            `;
        }
        
        // Generar reporte de ofrendas
        function generateOfferingReport() {
            const offerings = transactions.filter(t => 
                t.type === 'income' && t.category === 'ofrenda'
            );
            
            const offeringsByMonth = {};
            
            offerings.forEach(offering => {
                const key = `${offering.year}-${offering.month}`;
                if (!offeringsByMonth[key]) {
                    offeringsByMonth[key] = {
                        month: offering.month,
                        year: offering.year,
                        offerings: [],
                        total: 0
                    };
                }
                offeringsByMonth[key].offerings.push(offering);
                offeringsByMonth[key].total += offering.amount;
            });
            
            let summaryTable = '';
            
            if (Object.keys(offeringsByMonth).length > 0) {
                summaryTable = '<table style="width:100%; color:white;"><thead><tr><th>Mes</th><th>Cantidad de Ofrendas</th><th>Total Recaudado</th><th>Promedio por Ofrenda</th></tr></thead><tbody>';
                
                Object.values(offeringsByMonth).forEach(monthData => {
                    const monthName = new Date(monthData.year, monthData.month - 1, 1).toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
                    const average = monthData.total / monthData.offerings.length;
                    
                    summaryTable += `
                        <tr>
                            <td>${monthName}</td>
                            <td>${monthData.offerings.length}</td>
                            <td>$${monthData.total.toFixed(2)}</td>
                            <td>$${average.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                summaryTable += '</tbody></table>';
            } else {
                summaryTable = '<p style="text-align:center; padding:20px; color:#FFD700;">No hay ofrendas evangel√≠sticas registradas.</p>';
            }
            
            const totalOfferings = offerings.reduce((sum, t) => sum + t.amount, 0);
            const averageOffering = offerings.length > 0 ? totalOfferings / offerings.length : 0;
            
            return `
                <div style="margin-bottom: 20px; color: white;">
                    <p><strong>Total de Ofrendas Registradas:</strong> ${offerings.length}</p>
                    <p><strong>Total Recaudado en Ofrendas:</strong> $${totalOfferings.toFixed(2)}</p>
                    <p><strong>Promedio por Ofrenda:</strong> $${averageOffering.toFixed(2)}</p>
                </div>
                
                <h3 style="margin-top: 20px; margin-bottom: 10px; color: #FFD700;">Resumen por Mes</h3>
                <div class="table-container">
                    ${summaryTable}
                </div>
            `;
        }
        
        // Obtener nombre del trimestre
        function getQuarterName(quarter) {
            const quarterNames = {
                1: 'Primer',
                2: 'Segundo',
                3: 'Tercer',
                4: 'Cuarto'
            };
            return quarterNames[quarter] || quarter;
        }
        
        // Imprimir reporte
        function printReport() {
            const reportContent = document.getElementById('reportDetails').innerHTML;
            const reportTitle = document.getElementById('reportTitle').textContent;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>${reportTitle}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; background-color: white; color: black; }
                        h1 { color: #B22222; border-bottom: 2px solid #FFD700; padding-bottom: 10px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .positive { color: green; }
                        .negative { color: red; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .footer { margin-top: 30px; text-align: center; font-size: 0.9em; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${reportTitle}</h1>
                        <p><strong>Grupo de Evangelismo 2026</strong></p>
                        <p><strong>Fecha:</strong> ${new Date().toLocaleDateString('es-ES')}</p>
                    </div>
                    <hr>
                    ${reportContent}
                    <div class="footer">
                        <p>"Porque donde est√° tu tesoro, all√≠ estar√° tambi√©n tu coraz√≥n." - Mateo 6:21</p>
                        <p>Reporte generado por el Sistema de Contabilidad Evangel√≠stica</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Exportar a Excel
        function exportToExcel() {
            showAlert('Funci√≥n de exportaci√≥n a Excel disponible en la versi√≥n completa. Por ahora, usa la funci√≥n de imprimir.', 'info');
        }
        
        // Sincronizar con Firebase
        async function syncWithFirebase() {
            if (!firebaseConnected) {
                showAlert('No hay conexi√≥n a Firebase. Verifica tu conexi√≥n a internet.', 'warning');
                return;
            }
            
            try {
                // Aqu√≠ podr√≠as agregar l√≥gica para sincronizar datos locales con Firebase
                showSuccessMessage('Datos sincronizados correctamente con Firebase');
            } catch (error) {
                showAlert('Error al sincronizar: ' + error.message, 'warning');
            }
        }
        
        // Iniciar nuevo mes
        function startNewMonth() {
            if (confirm('¬øEst√°s listo para comenzar un nuevo mes en el registro de actividades evangel√≠sticas?')) {
                showSuccessMessage('¬°Bendiciones en el nuevo mes de ministerio! Recuerda registrar todas las ofrendas y gastos ministerial.');
            }
        }
        
        // Exportar todos los datos
        function exportAllData() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `evangelismo2026_datos_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccessMessage('Datos exportados exitosamente');
        }
        
        // Guardar en localStorage
        function saveToLocalStorage() {
            localStorage.setItem('evangelismoTransactions', JSON.stringify(transactions));
        }
        
        // Mostrar mensaje de √©xito
        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #228B22;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            messageDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 3000);
        }
        
        // Mostrar alerta
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.innerHTML = `
                <div class="alert-icon">
                    <i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                </div>
                <div>${message}</div>
            `;
            
            const container = document.getElementById('alertsContainer');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        
        // Actualizar estado de Firebase
        function updateFirebaseStatus(connected = false) {
            firebaseConnected = connected;
            const statusElement = document.getElementById('firebaseStatus');
            
            if (connected) {
                statusElement.className = 'firebase-status connected';
                statusElement.innerHTML = '<i class="fas fa-cloud"></i> <span>Sincronizado con Firebase</span>';
            } else {
                statusElement.className = 'firebase-status disconnected';
                statusElement.innerHTML = '<i class="fas fa-cloud-slash"></i> <span>Sin conexi√≥n a Firebase</span>';
            }
        }
    </script>
</body>
</html>
